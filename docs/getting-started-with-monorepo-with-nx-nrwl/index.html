<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Getting Started with Monorepo with Nx Nrwl - Rupesh Tiwari - Founder of Fullstack Master</title>
<meta name="description" content="Create Monorepo using Nx with angular projects and applications">


  <meta name="author" content="Rupesh Tiwari">
  
  <meta property="article:author" content="Rupesh Tiwari">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Rupesh Tiwari - Founder of Fullstack Master">
<meta property="og:title" content="Getting Started with Monorepo with Nx Nrwl">
<meta property="og:url" content="https://www.rupeshtiwari.com/getting-started-with-monorepo-with-nx-nrwl/">


  <meta property="og:description" content="Create Monorepo using Nx with angular projects and applications">



  <meta property="og:image" content="https://i.imgur.com/qxXxmBa.png">



  <meta name="twitter:site" content="@rupeshtiwari_co">
  <meta name="twitter:title" content="Getting Started with Monorepo with Nx Nrwl">
  <meta name="twitter:description" content="Create Monorepo using Nx with angular projects and applications">
  <meta name="twitter:url" content="https://www.rupeshtiwari.com/getting-started-with-monorepo-with-nx-nrwl/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://i.imgur.com/qxXxmBa.png">
  

  



  <meta property="article:published_time" content="2021-11-19T00:00:00+00:00">





  
    <meta property="article:publisher" content="https://www.facebook.com/fullstackmaster1">
  

  
    <meta property="fb:app_id" content="421181512329379">
  


<link rel="canonical" href="https://www.rupeshtiwari.com/getting-started-with-monorepo-with-nx-nrwl/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://www.rupeshtiwari.com/"
    
  }
</script>



  <meta name="msvalidate.01" content="8BC08291167B3E15CC4FCC21C5895052">




<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Rupesh Tiwari - Founder of Fullstack Master Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Rupesh Tiwari
          <span class="site-subtitle">Sr. Software Architect, Author &amp; Trainer</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/posts/">blog</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">about</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://youtube.com/fullstackmaster">youtube</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/consulting/">consulting</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://www.fullstackmaster.net/pro">angular training</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://fullstackmaster.net/login">sign in</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero" style=" background-image: url('');">
  
    <img src="https://i.imgur.com/zipiW93.png" alt="Getting Started with Monorepo with Nx Nrwl" class="page__hero-image">
  
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://www.rupeshtiwari.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Getting Started with Monorepo with Nx Nrwl</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt="Rupesh Tiwari" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Rupesh Tiwari</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I help students and professionals to become Full Stack Software Developer in less than a year!</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="rupesh.tiwari.info@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="/posts/" rel="nofollow noopener noreferrer"><i class="fa fa-th-large" aria-hidden="true"></i><span class="label">Blogs</span></a></li>
          
        
          
            <li><a href="https://rupesh-tiwari.medium.com/" rel="nofollow noopener noreferrer"><i class="fab fa-medium" aria-hidden="true"></i><span class="label">Medium</span></a></li>
          
        
          
            <li><a href="https://dev.to/rupeshtiwari" rel="nofollow noopener noreferrer"><i class="fab fa-dev" aria-hidden="true"></i><span class="label">Dev.to</span></a></li>
          
        
          
            <li><a href="http://github.com/rupeshtiwari" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/rupesh-tiwari" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="http://twitter.com/rupeshtiwari_co" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.facebook.com/fullstackmaster1" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://www.fullstackmaster.net" rel="nofollow noopener noreferrer"><i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="label">Angular Training</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Getting Started with Monorepo with Nx Nrwl">
    <meta itemprop="description" content="  Do you have a lot of JavaScript projects using GitHub repositories? How are you managing dependencies among those projects? Developers might be struggling to manage a large set of GitHub repositories and Business might be spending a lot of money to manage them. The potential solution to this problem is Monorepo. You can put all of your JavaScript projects regardless of framework (angular, vue.js, react.js) in a single GitHub repository called monorepo. This will solve the problem and you will not have many Git projects. However, nothing is free! So there are many challenges with monorepo that developers are facing. I will explain all of the challenges and show you how you can solve them. Also I will create monorepo from scratch in this article using angular projects as samples.">
    <meta itemprop="datePublished" content="2021-11-19T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Getting Started with Monorepo with Nx Nrwl
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          28 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li><a href="#what-is-monorepo">What is Monorepo?</a></li>
<li><a href="#why-to-use-monorepo">Why to use Monorepo?</a></li>
<li><a href="#what-should-i-know-before-using-monorepo">What should I know before using Monorepo?</a></li>
<li><a href="#where-is-source-code-for-nx-monorepo">Where is source code for Nx Monorepo?</a></li>
<li><a href="#challenges-with-monorepo">Challenges with Monorepo?</a></li>
<li>
<a href="#how-to-manage-versions-and-parallel-development">How to manage versions and parallel development?</a><ul>
<li><a href="#managing-releases-with-monorepo">Managing Releases with Monorepo</a></li>
<li><a href="#working-on-feature-branch-with-monorepo">Working on Feature Branch with Monorepo</a></li>
<li><a href="#managing-major-releases-with-monorepo">Managing Major Releases with Monorepo</a></li>
</ul>
</li>
<li>
<a href="#what-developer-will-learn-in-this-article">What Developer will learn in this article?</a><ul><li><a href="#in-the-monorepo-we-will-do-below-work">In the Monorepo we will do below work</a></li></ul>
</li>
<li>
<a href="#development-environment-setup">Development Environment Setup</a><ul>
<li><a href="#visual-studio-code-vscode">Visual Studio Code (VsCode)</a></li>
<li><a href="#visual-studio-code-extensions">Visual Studio Code Extensions</a></li>
<li><a href="#vscode-settings">Vscode Settings</a></li>
</ul>
</li>
<li><a href="#enable-karma-test-runner-in-nx-monorepo">Enable Karma Test Runner in Nx Monorepo</a></li>
<li><a href="#creating-first-nx-monorepo-using-cli">Creating First Nx Monorepo using CLI</a></li>
<li><a href="#creating-nx-monorepo-with-custom-settings">Creating Nx Monorepo with Custom Settings</a></li>
<li><a href="#understanding-nx-monorepo-workspace">Understanding Nx Monorepo Workspace</a></li>
<li><a href="#creating-projects-in-nx-monorepo">Creating Projects in Nx Monorepo</a></li>
<li><a href="#empty-nx-monorepo-advantage-and-disadvantages">Empty Nx Monorepo Advantage and Disadvantages</a></li>
<li><a href="#creating-new-empty-nx-monorepo-workspace">Creating new Empty Nx Monorepo workspace</a></li>
<li><a href="#what-nx-cli-does">What NX CLI does?</a></li>
<li><a href="#using-nx-cli-over-angular-cli">Using Nx CLI over Angular CLI</a></li>
<li><a href="#how-to-opt-out-of-nx-cli">How to opt out of NX CLI</a></li>
<li><a href="#understanding-nx-workspace-scripts">Understanding NX Workspace Scripts</a></li>
<li><a href="#creating-angular-library-using-nx-console">Creating Angular Library using Nx Console</a></li>
<li><a href="#how-to-stop-dryrun-while-using-nx-console">How to stop dryRun while using Nx Console?</a></li>
<li><a href="#creating-js-project-using-nx-console">Creating JS project using NX Console</a></li>
<li><a href="#how-to-create-run-command-in-nx-monorepo">How to create Run Command in NX Monorepo</a></li>
<li><a href="#step-create-angular-app-using-nx-console">Step: Create Angular App using Nx Console</a></li>
<li><a href="#adding-nx-cli-decorator-for-nx-empty-workspace">Adding Nx CLI Decorator for Nx Empty Workspace</a></li>
<li><a href="#step--lets-create-logging-service--tests">Step : Letâ€™s Create Logging Service &amp; Tests</a></li>
<li><a href="#step--lets-take-logger-dependency-on-our-application">Step : Letâ€™s take logger dependency on our application</a></li>
<li><a href="#adding-users-library-under-customers-service">Adding Users Library under Customers Service</a></li>
<li><a href="#creating-add-puppy-component-on-puppy-editor-project">Creating Add-Puppy Component on Puppy Editor project</a></li>
<li>
<a href="#add-puppies-component-in-the-customerspuppies-using-nx-console">Add Puppies component in the Customers/Puppies using Nx Console.</a><ul>
<li><a href="#adding-routes-for-admin-app">Adding routes for Admin App</a></li>
<li><a href="#adding-routes-for-client-app">Adding routes for Client App</a></li>
<li><a href="#serving-admin-component">Serving Admin component</a></li>
</ul>
</li>
<li><a href="#serving-client-app">Serving client app</a></li>
<li><a href="#monorepo-workspace-architecture">MonoRepo Workspace Architecture</a></li>
<li><a href="#monorepo-workspace-dependency-graph">MonoRepo Workspace Dependency Graph</a></li>
<li>
<a href="#creating-build-ci-pipeline">Creating Build CI pipeline</a><ul><li><a href="#caching-azure-pipeline">Caching Azure Pipeline</a></li></ul>
</li>
<li><a href="#create-artifact-feed-in-azure-devops">Create Artifact Feed in Azure devops</a></li>
<li>
<a href="#creating-azure-ci-pipeline">Creating Azure CI Pipeline</a><ul>
<li><a href="#step-1-create-template-yaml-file">Step 1: Create Template yaml File</a></li>
<li><a href="#step-2-generate-the-ci-script-dynamically">Step 2: Generate the ci script dynamically</a></li>
<li><a href="#step--create-azure-pipelinesyml-file">Step : Create azure-pipelines.yml file</a></li>
<li><a href="#step--lets-run-the-build">Step : Lets Run the Build</a></li>
<li><a href="#step--create-run-many-javascript">Step : Create Run Many JavaScript</a></li>
<li><a href="#step--add-lint-test-and-build-scripts">Step : Add lint, test and build scripts</a></li>
<li><a href="#step--lets-run-the-build-again">Step : Lets Run the build Again</a></li>
<li><a href="#step--lets-change-the-logger-and-find-out-affected-dependency-graph">Step : Lets Change the Logger and find out affected dependency graph</a></li>
<li><a href="#step-fix-admin-specs">Step: Fix admin specs</a></li>
<li><a href="#step-fix-client-specs">Step: Fix client specs</a></li>
<li><a href="#step--lets-push-the-code-and-notice-our-builds">Step : Lets Push the code and notice our Builds</a></li>
<li><a href="#step--running-all-lint-build-and-test-as-task">Step : Running all lint build and test as TASK</a></li>
<li><a href="#step-update-the-command-generation-script">Step: Update the command generation script</a></li>
<li><a href="#step--update-the-azure-pipeline-yml-to-have-steps-not-jobs">Step : Update the azure-pipeline yml to have Steps not jobs</a></li>
<li><a href="#step--change-logging-service-only-and-run-build">Step : Change logging service only and run build</a></li>
<li><a href="#step--finding-affected-apps">Step : Finding affected apps</a></li>
<li><a href="#step--lets-add-packagejson-in-applications">Step : Lets Add Package.json in applications</a></li>
<li><a href="#step--update-workspacejson-for-app">Step : Update workspace.json for app</a></li>
<li><a href="#step--build-in-production-mode">Step : Build in Production Mode</a></li>
<li><a href="#step-publishing-test-results-in-azure-pipeline-build">Step: Publishing Test Results in Azure Pipeline Build</a></li>
<li><a href="#step-publishing-code-coverage-in-azure-pipeline-build">Step: Publishing Code Coverage in Azure Pipeline Build</a></li>
<li><a href="#step-add-npmrc-file-to-app-that-we-want-to-publish-npm">Step: Add .npmrc file to app that we want to publish npm</a></li>
<li><a href="#step-updating-packagejson-version--publish-npm-package">Step: Updating Package.json Version &amp; Publish Npm package</a></li>
<li><a href="#step--push-you-changes-and-trigger-build">Step : Push you changes and Trigger Build</a></li>
<li><a href="#step-only-change-admin-and-notice-only-admin-is-published-in-npm">Step: Only change Admin and Notice only Admin is published in NPM</a></li>
</ul>
</li>
<li><a href="#karma-failing-when-no-test-present">Karma failing when no test present</a></li>
<li>
<a href="#monorepo-architecture-guideline-for-developers">Monorepo Architecture Guideline for developers</a><ul>
<li><a href="#what-do-smart-components-do">What do smart components do?Â </a></li>
<li><a href="#what-is-dumb--presentation-componetn-can-do">What is dumb / presentation componetn can do?</a></li>
<li><a href="#what-is-a-service">What is a service?</a></li>
<li><a href="#what-is-a-model">What is a Model?</a></li>
<li><a href="#what-is-a-store">What is a Store?Â </a></li>
<li><a href="#what-is-an-api-service">What is an API service?</a></li>
<li><a href="#who-depends-on-whom-within-a-library-">Who depends on whom within a library ?Â </a></li>
<li><a href="#before-push-to-git-guidelines">Before Push to Git Guidelines</a></li>
<li><a href="#naming-conventions">Naming conventions</a></li>
<li><a href="#nx-related-questions">Nx Related Questions</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <blockquote>
  <p>Do you have a lot of JavaScript projects using GitHub repositories? How are you managing dependencies among those projects? Developers might be struggling to manage a large set of GitHub repositories and Business might be spending a lot of money to manage them. The potential solution to this problem is Monorepo. You can put all of your JavaScript projects regardless of framework (angular, vue.js, react.js) in a single GitHub repository called monorepo. This will solve the problem and you will not have many Git projects. However, nothing is free! So there are many challenges with monorepo that developers are facing. I will explain all of the challenges and show you how you can solve them. Also I will create monorepo from scratch in this article using angular projects as samples.</p>
</blockquote>

<h2 id="what-is-monorepo">What is Monorepo?</h2>

<p>Single Git Repository holds source code of multiple applications and libraries.</p>

<h2 id="why-to-use-monorepo">Why to use Monorepo?</h2>

<p>Monorepo in organization helps you to get below benefits:</p>

<ul>
  <li>
<strong>Shared Code</strong>: Reuse code validation, tooling code, and libraries code in applications in a single repository.</li>
  <li>
<strong>Atomic Changes</strong>: Change the button component in the shared library and update the application that uses that button in the same commit.</li>
  <li>
<strong>Developer Mobility</strong>: Developers can easily contribute to any applications or libraries by just going to one source code repository.</li>
</ul>

<h2 id="what-should-i-know-before-using-monorepo">What should I know before using Monorepo?</h2>

<p>If you have already developed couple of JavaScript projects then you are good to go and learn Monorepo. For this article if you have basic knowledge of Angular then it will be good since I will create angular projects in example monorepo.</p>

<h2 id="where-is-source-code-for-nx-monorepo">Where is source code for Nx Monorepo?</h2>

<p>Here is the <a href="https://www.npmjs.com/package/nx">Nx npm package</a> that you can use from npm. For this article I will demonstrate code that is hosted in github at below location:</p>

<ul>
  <li><a href="https://github.com/rupeshtiwari/coding-examples-angular-monorepo-with-nx">Angular Monorepo Nrwl.NX sample</a></li>
  <li><a href="https://github.com/rupeshtiwari/coding-examples-angular-monorepo-nx-azure-ci-cd">Angular Monorepo Nrwl.NX sample with advance Microsoft Azure CI/CD Pipeline</a></li>
</ul>

<h2 id="challenges-with-monorepo">Challenges with Monorepo?</h2>

<p>Challenges are how to identify which application depends on how many projects? How to constrain dependency so that it reduces cyclic dependency issues and organizes code structure? How to only compile the project which has only changed? How to only run tests for the changed projects? How to increase tooling speed for a large set of projects in a single monorepo? How to manage versions? All of these are very important requirements. Nx.Nrwl monorepo framework is an excellent framework to manage any number of JavaScript projects in just one GitHub Repo. With Nx.Nrwl Monorepo you get facility to visualize which project depends on others. All of the challenges that I mentioned could be resolved by Nx Monorepo. Stay tuned and read this article till the end to create your angular monorepo from scratch using the Nx Monorepo framework.</p>

<h2 id="how-to-manage-versions-and-parallel-development">How to manage versions and parallel development?</h2>

<p>You could have your own policy as per your organizationâ€™s need to manage parallel development, release, fix, development, merging, major release, maintenance related work. However, I am suggesting one option. Letâ€™s see if that makes sense to you.</p>

<h3 id="managing-releases-with-monorepo">Managing Releases with Monorepo</h3>

<p>Create a branch for release number. Example <code class="language-plaintext highlighter-rouge">releases/11.0</code> treat this branch as active working branch. You can treat this as your <code class="language-plaintext highlighter-rouge">dev</code> branch.</p>

<p><img src="https://i.imgur.com/SQUdxd4.png" alt="" class="full"></p>

<h3 id="working-on-feature-branch-with-monorepo">Working on Feature Branch with Monorepo</h3>

<p>For adding new feature or working on some new PBI or usecase. Create a features folder and put PBI number as new branch in features folder work on development and merge them in to release branch.
Example: <code class="language-plaintext highlighter-rouge">features/PBI123/appendOrder</code></p>

<h3 id="managing-major-releases-with-monorepo">Managing Major Releases with Monorepo</h3>

<p>In order to do major release create a new branch <code class="language-plaintext highlighter-rouge">11.1</code> as major release branch. And if you want to apply fix on <code class="language-plaintext highlighter-rouge">11.1</code> then create another branch <code class="language-plaintext highlighter-rouge">11.1.1</code> work on fixes and merge them back to release branch <code class="language-plaintext highlighter-rouge">11.0</code> for future release.</p>

<p><img src="https://i.imgur.com/F4rqVdP.png" alt="" class="full"></p>

<h2 id="what-developer-will-learn-in-this-article">What Developer will learn in this article?</h2>

<p>In this article, I will walk you through the steps to create one <a href="https://nx.dev/">nx monorepo</a> workspace with Angular application and libraries from empty preset.</p>

<ol>
  <li>We will use Azure Pipeline Caching to improve build speed by caching npm packages.</li>
  <li>We will publish our application to npm from pipeline in automated fashion.</li>
</ol>

<h3 id="in-the-monorepo-we-will-do-below-work">In the Monorepo we will do below work</h3>

<ol>
  <li>I need <strong>Karma</strong> as test runner</li>
  <li>I <strong>donâ€™t need e2e test</strong> for applications</li>
  <li>I want my <strong>applications to be publishable</strong>
</li>
  <li>I want my <strong>libraries to be not publishable</strong>
</li>
  <li>Create <strong>Azure CI/CD pipelines</strong>
</li>
  <li>Deploy <strong>Application to NPM registry</strong>
</li>
</ol>

<h2 id="development-environment-setup">Development Environment Setup</h2>

<p>Hey developer, make sure you have <code class="language-plaintext highlighter-rouge">node.js</code> installed which is greater than <code class="language-plaintext highlighter-rouge">V10</code>. I have installed <code class="language-plaintext highlighter-rouge">node.js v14</code>.</p>

<h3 id="visual-studio-code-vscode">Visual Studio Code (VsCode)</h3>

<p>I am using Vs Code and installed nx console extension to get inbuilt way of creating apps/libs from nx console only.</p>

<h3 id="visual-studio-code-extensions">Visual Studio Code Extensions</h3>

<p>Install below VsCode extensions for better development experience:</p>

<ul>
  <li>
<a href="https://nx.dev/latest/angular/getting-started/console">Nx Console</a> in your vs code to create components without writing code.
<img src="https://i.imgur.com/gWKa76u.png%20=250x200" alt="">
</li>
  <li>
<a href="https://marketplace.visualstudio.com/items?itemName=johnpapa.angular-essentials">Angular Essentials Extensions by John Papa</a>
<img src="https://i.imgur.com/bUO042c.png" alt="" class="full">
</li>
  <li>
<a href="https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme">Material Theme VS Code Extension</a>: In order to see the icons for each file you must update the vscode settings. Take the custom Vs Code Settings of VsCode from <a href="#vscode-settings">this article</a>.</li>
  <li>
    <p><a href="https://marketplace.visualstudio.com/items?itemName=ms-azure-devops.azure-pipelines">Azure Pipelines</a> for validations of yml file
<img src="https://i.imgur.com/kZIWqaY.png" alt="" class="full"></p>
  </li>
  <li>Install <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">yaml visual studio extension</a>
<img src="https://i.imgur.com/Sqsa8gx.png" alt="" class="full">
</li>
</ul>

<p><strong>Below are optional but recommended extensions</strong></p>

<ul>
  <li>
<a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-todo-highlight">TODO Highlighter</a> : Optional it helps to highlight todo and fixme comments.
<img src="https://i.imgur.com/JT28IhH.png" alt="" class="full">
</li>
</ul>

<p><strong>FixMe Comments</strong>
FIXME: Comments are some things that you are planning to fix within the current sprint.<br>
Example: Fixing Api Service to call Server Web API within this sprint only.
Stories having FIXME are alarming for you. Make sure all FIXMEâ€™s are addressed before marking stories are done. ðŸ““ Notice: Once you fix the code then remove the comment ðŸ˜„
<img src="https://i.imgur.com/Zgbdf9N.png" alt="" class="full"></p>

<p><strong>Todo Comments</strong>
TODO: comments are something that you are planning to work on future sprints.
Example: Working on MCQ API Service to call server side API that has to be done on future sprint.
<img src="https://i.imgur.com/i48KY0n.png" alt="" class="full"></p>

<p>Check all todo comments <code class="language-plaintext highlighter-rouge">CTRL + SHIFT + P</code>
<img src="https://i.imgur.com/KUq3DFR.png" alt="" class="full"></p>

<ul>
  <li>
<a href="https://marketplace.visualstudio.com/items?itemName=KnisterPeter.vscode-commitizen">Conventional Commit Comments</a>
<img src="https://i.imgur.com/uDw6zDP.png" alt="" class="full">
<a href="https://gist.github.com/qoomon/5dfcdf8eec66a051ecd85625518cfd13#examples">Check out some examples of conentional commit comments</a>
</li>
</ul>

<h3 id="vscode-settings">Vscode Settings</h3>

<p>If you want to get the custom icons for your files then make sure you have installed VSCode Materials and copy below settings and paste in your local VSCode settings.json file located at <code class="language-plaintext highlighter-rouge">%appdata%\Code\User\settings.json</code></p>

<script src="https://gist.github.com/a4190a29aac0132082430cdb8a2e85ad.js"> </script>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="nl">"material-icon-theme.folders.associations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"itops"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vm"</span><span class="p">,</span><span class="w">
		    </span><span class="nl">"presentation"</span><span class="p">:</span><span class="s2">"Views"</span><span class="p">,</span><span class="w">
		    </span><span class="nl">"aggregate-score"</span><span class="p">:</span><span class="s2">"Sublime"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"aspects"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apollo"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"contracts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Scala"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"message-handlers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Serverless"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"branding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shared"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stack"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"composition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"include"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cluster"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"partials"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mock"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filters"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Terraform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"sharedviews"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Svelte"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dashboard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gulp"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ui-core"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Review"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intellij"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ngmaterial"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Theme"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ckeditor5"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mobile"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"launch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Docker"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"editor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Custom"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"toolbar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tools"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"pubsub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"message-handler"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Delta"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"api-composition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mock"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dto"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gradle"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"interfaces"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Animation"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"global-error-handler"</span><span class="p">:</span><span class="s2">"Error"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"root"</span><span class="p">:</span><span class="s2">"Svg"</span><span class="w">
    </span><span class="p">}</span><span class="err">,</span><span class="w">
    </span><span class="nl">"material-icon-theme.files.associations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"*.state.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Silverstripe"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.dto.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gradle"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.module.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Racket"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.routing.module.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"R"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.store.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Storybook"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.tests.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test-ts"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.controller.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Angular-component"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.enum.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jinja"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.service.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quasar"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.model.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaderlab"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.viewmodel.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pug"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.command.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.event.ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stencil"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"*.ts"</span><span class="p">:</span><span class="s2">"Idris"</span><span class="w">
    </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p>You will get below icons once updating settings file.</p>

<p><img src="https://i.imgur.com/P2D9gy6.png" alt="" class="full"></p>

<h2 id="enable-karma-test-runner-in-nx-monorepo">Enable Karma Test Runner in Nx Monorepo</h2>

<p>When you create nx monorepo with <code class="language-plaintext highlighter-rouge">Angular</code> or <code class="language-plaintext highlighter-rouge">React</code> or <code class="language-plaintext highlighter-rouge">Next.js</code> or <code class="language-plaintext highlighter-rouge">Gatsby</code> or <code class="language-plaintext highlighter-rouge">next.js</code> or <code class="language-plaintext highlighter-rouge">Web Components</code> then it will give you <code class="language-plaintext highlighter-rouge">JEST</code> as unit test runner. In case you want to get <code class="language-plaintext highlighter-rouge">karma</code> test runner then you have to create Empty workspace and then add <code class="language-plaintext highlighter-rouge">@nrwl/angular</code> then add new application or lib with karma unit test runner.</p>

<h2 id="creating-first-nx-monorepo-using-cli">Creating First Nx Monorepo using CLI</h2>

<p>In order to create your first Nx Monorepo workspace run below script:</p>

<p><code class="language-plaintext highlighter-rouge">npx create-nx-workspace@latest</code></p>

<ul>
  <li>Give workspace name: <code class="language-plaintext highlighter-rouge">myorg</code>
</li>
  <li>Select Layout: I select Angular Application (A workspace with a single Angular Application)</li>
  <li>Application Name: cutepuppies-admin</li>
  <li>Stylesheet Format: SASS</li>
  <li>Linter: TSLINT</li>
  <li>Nx Cloud: No ( this is default )</li>
</ul>

<p><img src="https://i.imgur.com/iMK98Jr.png" alt="" class="full"></p>

<p>It will create the workspace with angular app that we defined.</p>

<p><img src="https://i.imgur.com/X8fvsUc.png" alt="" class="full"></p>

<p>When you will use their template they will add end to end test for application. They will also add jest test runner.</p>

<p><img src="https://i.imgur.com/GLOkklz.png" alt="" class="full"></p>

<p>In my workspace, I do not want Jest and I do not want e2e tests. So I am creating my workspace with empty preset next.</p>

<h2 id="creating-nx-monorepo-with-custom-settings">Creating Nx Monorepo with Custom Settings</h2>

<ol>
  <li>
    <p>Run <code class="language-plaintext highlighter-rouge">npx create-nx-workspace@latest</code></p>
  </li>
  <li>
    <p>Give organization name: <code class="language-plaintext highlighter-rouge">curise</code></p>
  </li>
  <li>
    <p>Select angular application for the workspace. <code class="language-plaintext highlighter-rouge">angular</code></p>
  </li>
</ol>

<p>This will install <code class="language-plaintext highlighter-rouge">@nrwl/angular</code> plugin to give you tools to create angular lib and apps.</p>

<p><img src="https://i.imgur.com/zia6hBU.png" alt="" class="full"></p>

<ol>
  <li>Then enter angular application name: admin</li>
</ol>

<p><img src="https://i.imgur.com/jn9PH3x.png" alt="" class="full"></p>

<ol>
  <li>Next select Style format as SASS</li>
  <li>Default Linter: Choose TSLINT since I have angular app</li>
  <li>Nx Cloud give caching over cloud: No ( it needs paid subscription plan)</li>
</ol>

<p><img src="https://i.imgur.com/8XevXrP.png" alt="" class="full"></p>

<p>Run the script:
<img src="https://i.imgur.com/roU0Y90.png" alt="" class="full"></p>

<h2 id="understanding-nx-monorepo-workspace">Understanding Nx Monorepo Workspace</h2>

<p><img src="https://i.imgur.com/bNRYcQI.png" alt="" class="full"></p>

<ol>
  <li><strong>Apps</strong></li>
  <li><strong>libs</strong></li>
  <li>
<strong>tools</strong>
Tools folder has tsconfig file that means u can write typescript files and compile them in JS.</li>
  <li><strong>decorate-angular-cli.js</strong></li>
  <li><strong>jest.preset.js</strong></li>
  <li>
<strong>angular.json</strong>
It create angular.json file to manage your workspace. However, if you want to create empty monorepo project then it creates <strong>workspace.json</strong> file.</li>
</ol>

<h2 id="creating-projects-in-nx-monorepo">Creating Projects in Nx Monorepo</h2>

<p>Run <code class="language-plaintext highlighter-rouge">nx build</code></p>

<p><img src="https://i.imgur.com/Pig0oei.png" alt="" class="full"></p>

<p>Showing <code class="language-plaintext highlighter-rouge">dist</code> folder.</p>

<p><img src="https://i.imgur.com/wIjX2a2.png" alt="" class="full"></p>

<h2 id="empty-nx-monorepo-advantage-and-disadvantages">Empty Nx Monorepo Advantage and Disadvantages</h2>

<p>After creating empty workspace.</p>

<p><strong>Benefits of Empty Workspace</strong></p>

<ol>
  <li>You can use <code class="language-plaintext highlighter-rouge">karma</code> unit test runner</li>
  <li>You can use <code class="language-plaintext highlighter-rouge">workspace.json</code> to configure any apps and libs.</li>
</ol>

<p><strong>Disadvantages of empty workspace</strong>:</p>

<ol>
  <li>You have to write the angular cli decorator for <code class="language-plaintext highlighter-rouge">Nx CLI</code>
</li>
</ol>

<p>Regardless of empty or pre-populated workspace you must create your own <code class="language-plaintext highlighter-rouge">CI/CD</code> Pipelines and Nx commands for your pipelines.</p>

<h2 id="creating-new-empty-nx-monorepo-workspace">Creating new Empty Nx Monorepo workspace</h2>

<p>Now we will create our monorepo workslpace that we will continue using it. We will start from scratch empty monorepo.</p>

<p>Creating empty Nx Monorepo workspace is our final option for this example. So letâ€™s create desired working folder and from that location open <code class="language-plaintext highlighter-rouge">powershell</code> on windows machine I found working on <code class="language-plaintext highlighter-rouge">git bash commands</code> were not working nicely.</p>

<p>Run below script to create empty workspace</p>

<p><code class="language-plaintext highlighter-rouge">npx create-nx-workspace@latest --preset=empty</code></p>

<p>Above script will ask you</p>

<ol>
  <li>organization name and</li>
  <li>Want to use Nx Cloud or not.</li>
</ol>

<p><img src="https://i.imgur.com/2nPySWd.png" alt="" class="full"></p>

<p>Notice it created the workspace</p>

<p><img src="https://i.imgur.com/ApKE767.png" alt="" class="full"></p>

<p>So Now I get empty app and library folders.</p>

<p><img src="https://i.imgur.com/vl5KtTa.png" alt="" class="full"></p>

<p>This is my dependencies that I get in package.json</p>

<p><img src="https://i.imgur.com/Y4qQNIe.png" alt="" class="full"></p>

<h2 id="what-nx-cli-does">What NX CLI does?</h2>

<p><code class="language-plaintext highlighter-rouge">Nx CLI</code> commands will invoke <code class="language-plaintext highlighter-rouge">Angular CLI</code>. The <code class="language-plaintext highlighter-rouge">Nx CLI</code> simply does some optimizations before invoking the <code class="language-plaintext highlighter-rouge">Angular CLI</code>. <code class="language-plaintext highlighter-rouge">Nx Cli</code> can execute all of the <code class="language-plaintext highlighter-rouge">ng cli</code> commands. The benefit you get with <code class="language-plaintext highlighter-rouge">Nx CLI</code> is <strong>Computation Caching</strong> which gives faster execution of tasks. Also Nx CLI is technology agnostic You can use <code class="language-plaintext highlighter-rouge">Nx CLI</code> to run <code class="language-plaintext highlighter-rouge">angular</code>, <code class="language-plaintext highlighter-rouge">react</code>, <code class="language-plaintext highlighter-rouge">JavaScript</code> or any project scripts.
So it gives uniformity in your team to always run <code class="language-plaintext highlighter-rouge">Nx CLI</code> in your workspace regardless of any front-end technology you are using..</p>

<h2 id="using-nx-cli-over-angular-cli">Using Nx CLI over Angular CLI</h2>

<p>In order to point <code class="language-plaintext highlighter-rouge">ng cli</code> to <code class="language-plaintext highlighter-rouge">Nx CLI</code> we have to run <strong>decorate-angular-cli.js</strong> file. Because of <code class="language-plaintext highlighter-rouge">symlinking</code> you can still type <code class="language-plaintext highlighter-rouge">ng build</code> or <code class="language-plaintext highlighter-rouge">ng test</code> or <code class="language-plaintext highlighter-rouge">ng lint</code> in the terminal. The ng command, in this case, will point to nx, which will perform optimizations before invoking <code class="language-plaintext highlighter-rouge">ng</code>.</p>

<p>After install we can execute this decorator file.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"postinstall"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node ./decorate-angular-cli.js &amp;&amp; ngcc --properties es2015 browser module main --first-only --create-ivy-entry-points"</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<h2 id="how-to-opt-out-of-nx-cli">How to opt out of NX CLI</h2>

<p>Although I donâ€™t recommend this option <img class="emoji" title=":-1:" alt=":-1:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44e.png" height="20" width="20"><br>
However, in case you want to opt out of <code class="language-plaintext highlighter-rouge">NX CLI</code> then follow below steps:</p>

<ol>
  <li>Replace occurrences of nx with ng in your package.json</li>
  <li>Remove the script from your postinstall script in your package.json</li>
  <li>Delete and reinstall your node_modules</li>
</ol>

<p>We are not doing this though.</p>

<h2 id="understanding-nx-workspace-scripts">Understanding NX Workspace Scripts</h2>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"nx"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx serve"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx build"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx workspace-lint &amp;&amp; nx lint"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"e2e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx e2e"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:apps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:apps"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:libs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:libs"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:build"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:e2e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:e2e"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:lint"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected:dep-graph"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected:dep-graph"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"affected"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx affected"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx format:write"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"format:write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx format:write"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"format:check"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx format:check"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"update"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx migrate latest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"workspace-generator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx workspace-generator"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dep-graph"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx dep-graph"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"help"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nx help"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<h2 id="creating-angular-library-using-nx-console">Creating Angular Library using Nx Console</h2>

<p>I will use <code class="language-plaintext highlighter-rouge">nx console</code> to create application.</p>

<p>Since I want to create Angular applications and libraries I need <code class="language-plaintext highlighter-rouge">@nrwl/angular</code> node package to be
installed.</p>

<p>please run below script to install <code class="language-plaintext highlighter-rouge">@nrwl/angular</code></p>

<p><code class="language-plaintext highlighter-rouge">npm i -D @nrwl/angular</code></p>

<p><img src="https://i.imgur.com/uq8rqan.png" alt="" class="full"></p>

<p>Select Nx, then select generate and then select Angular Library.</p>

<p><img src="https://i.imgur.com/NzsCaoS.png" alt="" class="full"></p>

<p>Fill out the required fields. I want to create logger angular library under lib/branding folder with karma testing framework.</p>

<p><img src="https://i.imgur.com/rNAerhj.png" alt="" class="full"></p>

<p>This is my dry run result</p>

<p><img src="https://i.imgur.com/Erh9MXZ.png" alt="" class="full"></p>

<p>Logger project is created successfully.
<img src="https://i.imgur.com/OM0IQE3.png" alt="" class="full"></p>

<h2 id="how-to-stop-dryrun-while-using-nx-console">How to stop dryRun while using Nx Console?</h2>

<p>Currently there is no way you can stop dry run therefore, use the script to create application or lib.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nx generate @nrwl/angular:library <span class="nt">--name</span><span class="o">=</span>utils <span class="nt">--directory</span><span class="o">=</span>branding <span class="nt">--importPath</span><span class="o">=</span>@myor/branding-utils <span class="nt">--prefix</span><span class="o">=</span>myorg-branding-utils <span class="nt">--tags</span><span class="o">=</span>scope:branding,type:branding-utils <span class="nt">--no-interactive</span> <span class="nt">--dry-run</span>
</code></pre></div></div>

<h2 id="creating-js-project-using-nx-console">Creating JS project using NX Console</h2>

<p>NX Monorepo only support <code class="language-plaintext highlighter-rouge">JEST</code> or <code class="language-plaintext highlighter-rouge">NONE</code> unit test runner for Javascript project.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nx generate @nrwl/workspace:library <span class="nt">--name</span><span class="o">=</span>ckeditor5 <span class="nt">--directory</span><span class="o">=</span>branding <span class="nt">--importPath</span><span class="o">=</span>@myorg/branding-ckeditor5 <span class="nt">--prefix</span><span class="o">=</span>myorg-branding-ckeditor5 <span class="nt">--tags</span><span class="o">=</span>scope:branding,type:branding-ckeditor5 <span class="nt">--no-interactive</span> <span class="nt">--js</span> <span class="nt">--unitTestRunner</span><span class="o">=</span>none <span class="nt">--dry-run</span>
</code></pre></div></div>

<h2 id="how-to-create-run-command-in-nx-monorepo">How to create Run Command in NX Monorepo</h2>

<p>Nx Run Command helps to create custom commands</p>

<p><img src="https://i.imgur.com/6OPfuS6.png" alt="" class="full"></p>

<p><strong>Target Name</strong> : Bane of the target like <code class="language-plaintext highlighter-rouge">build</code>
<strong>Project Name</strong> : is the name of the project in the workspace.json file : <code class="language-plaintext highlighter-rouge">branding-ckeditor</code></p>

<p><strong>Command</strong>: <code class="language-plaintext highlighter-rouge">npm run build</code></p>

<p><strong>cwd</strong> location of the src folder of the project</p>

<p><strong>outputs</strong> where the build artifacts will be stored.
<img src="https://i.imgur.com/BS0ulgd.png" alt="" class="full"></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nx generate @nrwl/workspace:run-commands <span class="nt">--name</span><span class="o">=</span>build <span class="nt">--command</span><span class="o">=</span><span class="s1">'npm run build'</span> <span class="nt">--project</span><span class="o">=</span>branding-ckeditor5 <span class="nt">--cwd</span><span class="o">=</span>libs/branding/ckeditor5/src <span class="nt">--outputs</span><span class="o">=</span>libs/branding/ckeditor5 <span class="nt">--no-interactive</span> <span class="nt">--dry-run</span>
</code></pre></div></div>

<p>This will update the <code class="language-plaintext highlighter-rouge">workspace.json</code> and <code class="language-plaintext highlighter-rouge">nx.json</code></p>

<p><img src="https://i.imgur.com/JYPutPu.png" alt="" class="full"></p>

<p>Now you can run <code class="language-plaintext highlighter-rouge">nx build branding-ckeditor5</code></p>

<h2 id="step-create-angular-app-using-nx-console">Step: Create Angular App using Nx Console</h2>

<p>Letâ€™s select an angular application this time to create cutepuppies-admin apps.
<img src="https://i.imgur.com/XRG6STh.png" alt="" class="full"></p>

<p>Name: cutepuppies-admin
<img src="https://i.imgur.com/QNPMMpp.png" alt="" class="full"></p>

<p>e2eTestRunner: none ( I donâ€™t want this test )
<img src="https://i.imgur.com/FzeuvBR.png" alt="" class="full"></p>

<p>Routing: Generates a routing module select this.</p>

<p><img src="https://i.imgur.com/oW0DuLZ.png" alt="" class="full"></p>

<p>Tags: scope:itops,type:itops-cutepuppies-admin
Unit Test Runner: Karma
<img src="https://i.imgur.com/x75qAxN.png" alt="" class="full"></p>

<p>Click on the Run button and finally select SASS while it is asking for which style format.
See my app is created
<img src="https://i.imgur.com/fAz1Q1y.png" alt="" class="full"></p>

<h2 id="adding-nx-cli-decorator-for-nx-empty-workspace">Adding Nx CLI Decorator for Nx Empty Workspace</h2>

<h2 id="step--lets-create-logging-service--tests">Step : Letâ€™s Create Logging Service &amp; Tests</h2>

<p>Letâ€™s create a loggingService inside our logger project.
Use Nx Console to create angular service.
<img src="https://i.imgur.com/ynFGEdp.png" alt="" class="full"></p>

<p>This is dry run result of angular service creation
<img src="https://i.imgur.com/oyCwe1b.png" alt="" class="full"></p>

<p>Fill out the form add below information
<img src="https://i.imgur.com/SZDx1N5.png" alt="" class="full"></p>

<p>Name: logging
project: branding-logger
Notice Logger service created
<img src="https://i.imgur.com/7aLT4Yn.png" alt="" class="full"></p>

<p>Lets run the test and see if the test is passing or not. Since I am using main branch instead of master branch I will update my scripts to take base as main branch only.</p>

<p><img src="https://i.imgur.com/LQmjidP.png" alt="" class="full"></p>

<p>Since only logging service is added if I run the test only one project test will run.
Run npm run affected:test
<img src="https://i.imgur.com/owTmYZl.png" alt="" class="full"></p>

<h2 id="step--lets-take-logger-dependency-on-our-application">Step : Letâ€™s take logger dependency on our application</h2>

<p>Next lest run the build
<img src="https://i.imgur.com/2OAeDSS.png" alt="" class="full"></p>

<p>npm run affected:build
<img src="https://i.imgur.com/wfr90IZ.png" alt="" class="full"></p>

<p>Notice the app is building and the dist folder is created with one app.</p>

<p><img src="https://i.imgur.com/noosk8r.png" alt="" class="full"></p>

<p>Now letâ€™s use a logging service to log something and run our application next.</p>

<p>Go to libs/branding/logger/src/index.ts and export the logger service.</p>

<p><img src="https://i.imgur.com/7w7SM23.png" alt="" class="full"></p>

<p>Next go to apps\cutepuppies-admin\src\app\app.component.ts and add logging service and log in constructor.
<img src="https://i.imgur.com/QGpa6da.png" alt="" class="full"></p>

<p>Lets serve our application run below script</p>

<p>nx serve cutepuppies-admin</p>

<p><img src="https://i.imgur.com/wyde0hs.png" alt="" class="full"></p>

<p>Navigate to http://localhost:4200 and see in console log hello world is coming.</p>

<p><img src="https://i.imgur.com/FMj0LWO.png" alt="" class="full"></p>

<p>Now lets build the application again and go to the dist folder and run below script from dist folder</p>

<p>cd dist/apps/cutepuppies-admin &amp;&amp; npx http-server -o</p>

<p>Notice our app is running and I see the log as well.</p>

<p><img src="https://i.imgur.com/GveyEna.png" alt="" class="full"></p>

<p>Creating Cute Puppies Client
<img src="https://i.imgur.com/KiVPRi2.png" alt="" class="full"></p>

<p>Created Sales/PuppyEditor
<img src="https://i.imgur.com/LrT06gn.png" alt="" class="full"></p>

<p>Creating sales/puppies</p>

<p><img src="https://i.imgur.com/oRMOvDt.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/M4nNi9M.png" alt="" class="full"></p>

<h2 id="adding-users-library-under-customers-service">Adding Users Library under Customers Service</h2>

<p><img src="https://i.imgur.com/fs31irh.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/KbjCP4n.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/69WJwUz.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/fJda329.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/0EXHyZr.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/xsETtU5.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/fZv6tcS.png" alt="" class="full"></p>

<p>Adding sales puppies route to client app.
<img src="https://i.imgur.com/B5PJ3BX.png" alt="" class="full"></p>

<p>Adding puppy editor route in admin app</p>

<p><img src="https://i.imgur.com/XPNXHTP.png" alt="" class="full"></p>

<h2 id="creating-add-puppy-component-on-puppy-editor-project">Creating Add-Puppy Component on Puppy Editor project</h2>

<p><img src="https://i.imgur.com/KQcjsJL.png" alt="" class="full"></p>

<p>Declaring Module: libs/sales/puppy-editor/src/lib/sales-puppy-editor.module.ts</p>

<p><img src="https://i.imgur.com/4Kn3o3C.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/SJO5aT3.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/Dc4DbjL.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/u6Mj2Jx.png" alt="" class="full"></p>

<p>Check Dry Run result and confirm
<img src="https://i.imgur.com/09Ly6gw.png" alt="" class="full"></p>

<p>and select Run
<img src="https://i.imgur.com/BVo8q7V.png" alt="" class="full"></p>

<p>Component Created</p>

<p><img src="https://i.imgur.com/3fGPE1t.png" alt="" class="full"></p>

<p>Component is good
<img src="https://i.imgur.com/Aze7pmz.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/hzcmhnM.png" alt="" class="full"></p>

<h2 id="add-puppies-component-in-the-customerspuppies-using-nx-console">Add Puppies component in the Customers/Puppies using Nx Console.</h2>

<p><img src="https://i.imgur.com/I6UJayT.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/ozBq2Tg.png" alt="" class="full"></p>

<p>To get the path of the component copy the relative path of lib folder of sales/puppies <code class="language-plaintext highlighter-rouge">/libs/sales/puppies/src/lib</code></p>

<p><img src="https://i.imgur.com/6Wh60db.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/ybNcmwX.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/1RdC1PS.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/VuJK34K.png" alt="" class="full"></p>

<p>Select Run to create component</p>

<p><img src="https://i.imgur.com/T57LNcC.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/mFVIQJI.png" alt="" class="full">
<img src="https://i.imgur.com/nMdYTc8.png" alt="" class="full">
Lets update the routing for puppies
<img src="https://i.imgur.com/zfWzwRy.png" alt="" class="full">
Add route for add puppy in puppy editor
<img src="https://i.imgur.com/s6dEpx8.png" alt="" class="full"></p>

<h3 id="adding-routes-for-admin-app">Adding routes for Admin App</h3>

<p>Add route in admin app: add below route to navigate to puppy editor default component
<img src="https://i.imgur.com/CEJQgz9.png" alt="" class="full"></p>

<h3 id="adding-routes-for-client-app">Adding routes for Client App</h3>

<p>Add route in client app: add below route to navigate to puppies moduleâ€™s default component.
<img src="https://i.imgur.com/eLa5JoV.png" alt="" class="full"></p>

<h3 id="serving-admin-component">Serving Admin component</h3>

<p>Lets add scripts to serve both admin and client app</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"start-admin"</span><span class="p">:</span><span class="s2">"nx serve cutepuppies-admin --port=4210 -o"</span><span class="err">,</span><span class="w">
</span><span class="nl">"start-client"</span><span class="p">:</span><span class="s2">"nx serve cutepuppies-client --port=4211 -o"</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://i.imgur.com/nEnnhWf.png" alt="" class="full"></p>

<p>Lets clean app component HTML</p>

<p><img src="https://i.imgur.com/wmIXSdj.png" alt="" class="full"></p>

<p>Lets run the admin app <code class="language-plaintext highlighter-rouge">npm run start-admin</code></p>

<p><img src="https://i.imgur.com/Kn9feLH.png" alt="" class="full"></p>

<p>Admin Site is up and running
http://localhost:4210/puppies-editor</p>

<p><img src="https://i.imgur.com/VE8KYyh.png" alt="" class="full"></p>

<h2 id="serving-client-app">Serving client app</h2>

<p>app component
<img src="https://i.imgur.com/cAGJAjc.png" alt="" class="full"></p>

<p>Run <code class="language-plaintext highlighter-rouge">npm run start-client</code>
<img src="https://i.imgur.com/SW5kU3k.png" alt="" class="full"></p>

<p>Client site is running : http://localhost:4211/puppies
<img src="https://i.imgur.com/o0iSvPJ.png" alt="" class="full"></p>

<h2 id="monorepo-workspace-architecture">MonoRepo Workspace Architecture</h2>

<p><strong>Apps</strong></p>

<ul>
  <li>Apps are IT-Ops systems</li>
  <li>It can depend on anything</li>
  <li>Only apps are buildable and publishable to npm repositories.</li>
</ul>

<p><strong>Libs</strong></p>

<ul>
  <li>Libs are services</li>
  <li>Services should have multiple projects</li>
  <li>Services should not depend on each other</li>
  <li>Services projects should not depend on each other. Unless it is configured to do so.</li>
  <li>Services projects can depend on Branding</li>
  <li>Services projects are not buildable and not publishable</li>
  <li>Services projects has a libs folder which is equivalent to modules folder.</li>
</ul>

<h2 id="monorepo-workspace-dependency-graph">MonoRepo Workspace Dependency Graph</h2>

<p>Run <code class="language-plaintext highlighter-rouge">nx dep-graph --base=main</code></p>

<p><img src="https://i.imgur.com/1bA7G5Z.png" alt="" class="full"></p>

<h2 id="creating-build-ci-pipeline">Creating Build CI pipeline</h2>

<p>Install <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">yaml visual studio extension</a>
<img src="https://i.imgur.com/T9rDvmQ.png" alt="" class="full"></p>

<p>Install <a href="https://marketplace.visualstudio.com/items?itemName=ms-azure-devops.azure-pipelines">Azure Pipelines</a> for validations of yml file</p>

<p><img src="https://i.imgur.com/D9VxmG9.png" alt="" class="full"></p>

<h3 id="caching-azure-pipeline">Caching Azure Pipeline</h3>

<p>We will install node modules and cache it so that for future build it will read from the cache location. If package-lock.json is changed it will refresh the cache.</p>

<p>We are going to use <strong>Restores and saves pipeline artifacts with Universal Packages</strong> to cache the ci pipelines. So Install the Task in your azure devops from marketplace.</p>

<p><a href="https://marketplace.visualstudio.com/items?itemName=1ESLighthouseEng.PipelineArtifactCaching">Restores and saves pipeline artifacts with Universal Packages</a>
<img src="https://i.imgur.com/pNN6xl4.png" alt="" class="full"></p>

<p>Since we are use pipeline cache, we need to create Artifacts Feed in Azure devops to store the node_modules folders. <a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/concepts/feeds?view=azure-devops">Learn more about Artifacts Feed</a></p>

<h2 id="create-artifact-feed-in-azure-devops">Create Artifact Feed in Azure devops</h2>

<blockquote>
  <p>Artifacts Feeds are organizational constructs that allow you to store, manage, and group your packages and control who to share it with. Feeds are not package-type dependent. You can store all the following package types in a single feed: npm, NuGet, Maven, Python, and Universal packages.</p>
</blockquote>

<ol>
  <li>Go to Azure Artifacts.
<img src="https://i.imgur.com/DaCSK2x.png" alt="" class="full">
</li>
  <li>Select Create Feed.
<img src="https://i.imgur.com/jST8Fj8.png" alt="" class="full">
</li>
  <li>Give your feed a Name and choose its visibility, upstream sources and scope.
<img src="https://i.imgur.com/063qIt2.png" alt="" class="full">
<img src="https://i.imgur.com/r4XYaCa.png" alt="" class="full">
</li>
</ol>

<h2 id="creating-azure-ci-pipeline">Creating Azure CI Pipeline</h2>

<p>Follow steps to create build definition</p>

<h3 id="step-1-create-template-yaml-file">Step 1: Create Template yaml File</h3>

<p>Then go to project and create install-node-module.yml file:
<img src="https://i.imgur.com/fLed9Hi.png" alt="" class="full"></p>

<ol>
  <li>We will install node.js</li>
  <li>We will write the task to cache the node_modules folder into the azure feed.</li>
  <li>Then we will install node packages if cache does not exist.</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">steps</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">NodeTool@0</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">versionSpec</span><span class="pi">:</span> <span class="s1">'</span><span class="s">14.x'</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Install</span><span class="nv"> </span><span class="s">Node.js'</span>
  <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">1ESLighthouseEng.PipelineArtifactCaching.RestoreAndSaveCacheV1.RestoreAndSaveCache@1</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">keyfile</span><span class="pi">:</span> <span class="s1">'</span><span class="s">**/package-lock.json,</span><span class="nv"> </span><span class="s">!**/node_modules/**/package-lock.json,</span><span class="nv"> </span><span class="s">!**/.*/**/package-lock.json'</span>
      <span class="na">targetfolder</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.SourcesDirectory)/node_modules'</span>
      <span class="na">vstsFeed</span><span class="pi">:</span> <span class="s1">'</span><span class="s">nx_azure_node_modules_cache_feed'</span>
  <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">npm ci --ignore-engines</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">Install dependencies only if there is no cache available</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="s">ne(variables['CacheRestored'], 'true')</span>
</code></pre></div></div>

<h3 id="step-2-generate-the-ci-script-dynamically">Step 2: Generate the ci script dynamically</h3>

<p><img src="https://i.imgur.com/yRtHDzM.png" alt="" class="full"></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * # Generate Ci command
 * 1. It will identify the affected projects
 * 2. Group the projects in 3 groups for each command.
 * ## Example:
 *  If 3 projects are affected it will create below group for lint, test and build command
 *          lint1:[admin], lint2:[logger], lint3:[client]
 *          build1:[admin], build2:[logger], build3:[client]( if you made buildable for each projects)
 *          test1:[admin], test2:[logger], test3:[client]( if you have tests for each projects)
 *  If 4 projects are affected it will create below group for lint, test and build command
 *          lint1:[admin,ngmaterial], lint2:[logger], lint3:[client]
 *          build1:[admin,ngmaterial], build2:[logger], build3:[client]( if you made buildable for each projects)
 *          test1:[admin,ngmaterial], test2:[logger], test3:[client] ( if you have tests for each projects)
 */</span>

<span class="kd">const</span> <span class="nx">execSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">execSync</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">isMaster</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">False</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">baseSha</span> <span class="o">=</span> <span class="nx">isMaster</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">origin/main~1</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">origin/main</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">lint</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">})</span>
<span class="p">);</span>

<span class="kd">function</span> <span class="nx">commands</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
    <span class="nx">execSync</span><span class="p">(</span><span class="s2">`npx nx print-affected --base=</span><span class="p">${</span><span class="nx">baseSha</span><span class="p">}</span><span class="s2"> --target=</span><span class="p">${</span><span class="nx">target</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
  <span class="p">).</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">project</span><span class="p">);</span>

  <span class="nx">array</span><span class="p">.</span><span class="nx">sort</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
  <span class="kd">const</span> <span class="nx">third</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">a1</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">third</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">a2</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">third</span><span class="p">,</span> <span class="nx">third</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">a3</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">third</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">target</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">]:</span> <span class="nx">a1</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">target</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">]:</span> <span class="nx">a2</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">target</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">3</span><span class="dl">'</span><span class="p">]:</span> <span class="nx">a3</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="step--create-azure-pipelinesyml-file">Step : Create azure-pipelines.yml file</h3>

<p><img src="https://i.imgur.com/2oCIB4J.png" alt="" class="full"></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">trigger</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">main</span> <span class="c1"># Trigger CI automatically whenever main branch is changed</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">initial_setup</span> <span class="c1"># Install Node.js &amp; Node Packages &amp; Generate Commands for Affected Projects.</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">IS_PR</span><span class="pi">:</span> <span class="s">$[ eq(variables['Build.Reason'], 'PullRequest') ]</span> <span class="c1"># Findout Is this pull request?</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span> <span class="c1"># Base Template</span>
      <span class="pi">-</span> <span class="na">powershell</span><span class="pi">:</span> <span class="s">echo "##vso[task.setvariable variable=COMMANDS;isOutput=true]$(node ./tools/scripts/generate-ci-commands.js $(IS_PR))"</span> <span class="c1"># Create COMMANDS build time variable and assign ci commands.</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">setCommands</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">echo $(setCommands.COMMANDS)</span> <span class="c1"># Echo the command for log purpose.</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">echoCommands</span>
</code></pre></div></div>

<h3 id="step--lets-run-the-build">Step : Lets Run the Build</h3>

<p><img src="https://i.imgur.com/GOUP7Se.png" alt="" class="full"></p>

<p>Select run
<img src="https://i.imgur.com/sO8rVJ0.png" alt="" class="full"></p>

<p>This time we have not changed the code therefore no build command created.
<img src="https://i.imgur.com/JxNUOsa.png" alt="" class="full"></p>

<h3 id="step--create-run-many-javascript">Step : Create Run Many JavaScript</h3>

<p><img src="https://i.imgur.com/bEu4amr.png" alt="" class="full"></p>

<p>In order to run the lint, test and build we have to create run-many.js file where we will put our script.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * # Run Many
 * It will run the script using nx command line to run them in parellel.
 */</span>

<span class="kd">const</span> <span class="nx">execSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">execSync</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">commands</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">projects</span> <span class="o">=</span> <span class="nx">commands</span><span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]];</span>
<span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="nx">execSync</span><span class="p">(</span>
  <span class="s2">`npx nx run-many --target=</span><span class="p">${</span><span class="nx">target</span><span class="p">}</span><span class="s2"> --projects=</span><span class="p">${</span><span class="nx">projects</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">,</span><span class="dl">'</span>
  <span class="p">)}</span><span class="s2"> --parallel`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="na">stdio</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="step--add-lint-test-and-build-scripts">Step : Add lint, test and build scripts</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">trigger</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">main</span> <span class="c1"># Trigger CI automatically whenever main branch is changed</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">initial_setup</span> <span class="c1"># Install Node.js &amp; Node Packages &amp; Generate Commands for Affected Projects.</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">IS_PR</span><span class="pi">:</span> <span class="s">$[ eq(variables['Build.Reason'], 'PullRequest') ]</span> <span class="c1"># Findout Is this pull request?</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="s">CAMTASIA_19_MEDIA_FORMAT*C:\Users\Rupesh\Documents\Camtasia\Rec 01-21-21_003.trec|Product  - template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span> <span class="c1"># Base Template</span>
      <span class="pi">-</span> <span class="na">powershell</span><span class="pi">:</span> <span class="s">echo "##vso[task.setvariable variable=COMMANDS;isOutput=true]$(node ./tools/scripts/generate-ci-commands.js $(IS_PR))"</span> <span class="c1"># Create COMMANDS build time variable and assign ci commands.</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">setCommands</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">echo $(setCommands.COMMANDS)</span> <span class="c1"># Echo the command for log purpose.</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">echoCommands</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">lint1</span> <span class="c1"># Lets Run the Linting command for lint1 array.</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span>
      <span class="pi">|</span> <span class="c1"># Make sure this is passing and Don't Run this if we have empty array in nx commands from intial_setup step.</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"lint1":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' lint1 lint</span> <span class="c1"># Run the lint command in parallel</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">lint2</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"lint2":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' lint2 lint</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">lint3</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"lint2":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' lint3 lint</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">test1</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">and(</span>
          <span class="s">succeeded(),</span>
          <span class="s">not(contains(</span>
            <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
            <span class="s">'"test1":[]'</span>
          <span class="s">))</span>
        <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' test1 test</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">test2</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"test2":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' test2 test</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">test3</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"test3":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' test3 test</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">build1</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"build1":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' build1 build`</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">build2</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"build2":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' build2 build</span>

  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">build3</span>
    <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">initial_setup</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
          <span class="s">dependencies.initial_setup.outputs['setCommands.COMMANDS'],</span>
          <span class="s">'"build3":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">variables</span><span class="pi">:</span>
      <span class="na">COMMANDS</span><span class="pi">:</span> <span class="s">$[ dependencies.initial_setup.outputs['setCommands.COMMANDS'] ]</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">.azure-pipelines/steps/install-node-modules.yml</span>
      <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' build3 build</span>

</code></pre></div></div>

<h3 id="step--lets-run-the-build-again">Step : Lets Run the build Again</h3>

<p>Notice since we have not changed any code we will notice only initial_setup and rest all jobs will be skipped.</p>

<p><img src="https://i.imgur.com/QiHKC9V.png" alt="" class="full"></p>

<h3 id="step--lets-change-the-logger-and-find-out-affected-dependency-graph">Step : Lets Change the Logger and find out affected dependency graph</h3>

<p>Go libs\branding\logger\src\lib\logging.service.ts
<img src="https://i.imgur.com/aeU11m5.png" alt="" class="full"></p>

<p>Run <code class="language-plaintext highlighter-rouge">npm run affected:dep-graph</code></p>

<p><img src="https://i.imgur.com/Tu2E3ML.png" alt="" class="full"></p>

<p>confirm changes are working Run <code class="language-plaintext highlighter-rouge">npm run start-admin</code></p>

<p><img src="https://i.imgur.com/iVTsegC.png" alt="" class="full"></p>

<h3 id="step-fix-admin-specs">Step: Fix admin specs</h3>

<p>Lets create a script to test and watch
<img src="https://i.imgur.com/FTvQoP8.png" alt="" class="full"></p>

<p>Now lets fix the test for admin project correct the title name
Now run <code class="language-plaintext highlighter-rouge">npm run affected:test</code></p>

<p>It will automatically run the admin test.</p>

<p><img src="https://i.imgur.com/zxF2qE5.png" alt="" class="full"></p>

<h3 id="step-fix-client-specs">Step: Fix client specs</h3>

<p>Now lest fix the test for client project correct the title name
Now run <code class="language-plaintext highlighter-rouge">npm run affected:test</code>
It will automatically run the both admin &amp; client test.
<img src="https://i.imgur.com/WAnxb3L.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/8tn43Vi.png" alt="" class="full"></p>

<h3 id="step--lets-push-the-code-and-notice-our-builds">Step : Lets Push the code and notice our Builds</h3>

<p>See this time in the build machine as well it identified</p>

<ol>
  <li>Only 2 projects to lint and test and they are
    <ol>
      <li>â€œbranding-loggerâ€,â€cutepuppies-adminâ€</li>
    </ol>
  </li>
  <li>Only 1 Project to build and that is:â€cutepuppies-adminâ€</li>
</ol>

<p>Notice test and build are passing</p>

<p><img src="https://i.imgur.com/Yj8uQdv.png" alt="" class="full"></p>

<h3 id="step--running-all-lint-build-and-test-as-task">Step : Running all lint build and test as TASK</h3>

<p>We dont want to trigger these many jobs since our monorepo is not that large. Therefore, I am deciding to create just one job so lets follow below steps.</p>

<h3 id="step-update-the-command-generation-script">Step: Update the command generation script</h3>

<p>Lets update the build definition to run them as task within single job.</p>

<p>Rename the current file to generate-ci-batch-commands.js
And create new file generate-ci-commands.js
<img src="https://i.imgur.com/RK1V28L.png" alt="" class="full"></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * # Generate Ci command
 * 1. It will identify the affected projects
 * 2. Group the projects in 3 groups for each command.
 * ## Example:
 *  If 3 projects are affected it will create below group for lint, test and build command
 *          lint1:[admin], lint2:[logger], lint3:[client]
 *          build1:[admin], build2:[logger], build3:[client]( if you made buildable for each projects)
 *          test1:[admin], test2:[logger], test3:[client]( if you have tests for each projects)
 *  If 4 projects are affected it will create below group for lint, test and build command
 *          lint1:[admin,ngmaterial], lint2:[logger], lint3:[client]
 *          build1:[admin,ngmaterial], build2:[logger], build3:[client]( if you made buildable for each projects)
 *          test1:[admin,ngmaterial], test2:[logger], test3:[client] ( if you have tests for each projects)
 */</span>
<span class="k">debugger</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">execSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">execSync</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">isMaster</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">False</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">baseSha</span> <span class="o">=</span> <span class="nx">isMaster</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">origin/main~1</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">origin/main</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">lint</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">})</span>
<span class="p">);</span>

<span class="kd">function</span> <span class="nx">commands</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
    <span class="nx">execSync</span><span class="p">(</span><span class="s2">`npx nx print-affected --base=</span><span class="p">${</span><span class="nx">baseSha</span><span class="p">}</span><span class="s2"> --target=</span><span class="p">${</span><span class="nx">target</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
  <span class="p">).</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">project</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span> <span class="p">[</span><span class="nx">target</span><span class="p">]:</span> <span class="nx">array</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you run this script, after changing logger project. It will generate the commands for the affected projects. Like below</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-admin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"branding-logger"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-admin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"branding-logger"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-admin"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="https://i.imgur.com/IiVl5jO.png" alt="" class="full"></p>

<h3 id="step--update-the-azure-pipeline-yml-to-have-steps-not-jobs">Step : Update the azure-pipeline yml to have Steps not jobs</h3>

<p>Rename the current azure-pipeline yml
<img src="https://i.imgur.com/tNAGfrK.png" alt="" class="full"></p>

<p>and move to .azure-pipeline/steps folder for future use or backup.</p>

<p><img src="https://i.imgur.com/67QekSa.png" alt="" class="full"></p>

<p>azure-pipelines.yml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">trigger</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">main</span> <span class="c1"># Trigger CI automatically whenever main branch is changed</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">IS_PULLREQUEST</span><span class="pi">:</span> <span class="s">$[eq(variables['Build.Reason'], 'PullRequest')]</span>

<span class="na">steps</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">Cache@2</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Cache</span><span class="nv"> </span><span class="s">Npm</span><span class="nv"> </span><span class="s">Dependencies'</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">key</span><span class="pi">:</span> <span class="s1">'</span><span class="s">**/package-lock.json,</span><span class="nv"> </span><span class="s">!**/node_modules/**/package-lock.json,</span><span class="nv"> </span><span class="s">!**/.*/**/package-lock.json'</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.SourcesDirectory)/node_modules'</span>
      <span class="na">cacheHitVar</span><span class="pi">:</span> <span class="s1">'</span><span class="s">CacheRestored'</span>

  <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">Npm@1</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">npm</span><span class="nv"> </span><span class="s">ci'</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">ci</span>
      <span class="na">verbose</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="s">ne(variables['CacheRestored'], 'true')</span>

  <span class="pi">-</span> <span class="na">powershell</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">echo "##vso[task.setvariable variable=COMMANDS]$(node ./tools/scripts/generate-ci-commands.js $(IS_PULLREQUEST))"</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">setCommands</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">setting commands</span>

  <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">echo $(COMMANDS)</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">echoCommands</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">commands to run</span>

  <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' lint</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">linting</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
            <span class="s">variables['COMMANDS'],</span>
            <span class="s">'"lint":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>

  <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' test</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">testing</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
            <span class="s">variables['COMMANDS'],</span>
            <span class="s">'"test":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
  <span class="pi">-</span> <span class="na">script</span><span class="pi">:</span> <span class="s">node ./tools/scripts/run-many.js '$(COMMANDS)' build</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">building</span>
    <span class="na">condition</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">and(</span>
        <span class="s">succeeded(),</span>
        <span class="s">not(contains(</span>
            <span class="s">variables['COMMANDS'],</span>
            <span class="s">'"build":[]'</span>
        <span class="s">))</span>
      <span class="s">)</span>
</code></pre></div></div>

<p>Run build</p>

<p><img src="https://i.imgur.com/Pjkjjwu.png" alt="" class="full"></p>

<h3 id="step--change-logging-service-only-and-run-build">Step : Change logging service only and run build</h3>

<p><img src="https://i.imgur.com/tWw04V4.png" alt="" class="full"></p>

<p>Run build</p>

<p><img src="https://i.imgur.com/IGmdmo1.png" alt="" class="full"></p>

<p>Build Success
<img src="https://i.imgur.com/8F5gXDb.png" alt="" class="full"></p>

<h3 id="step--finding-affected-apps">Step : Finding affected apps</h3>

<p>Lets update the commands to also give a list of apps to publish in npm repository.</p>

<p>When We change logger we want to also see publish array with affected app.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"branding-logger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"branding-logger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"publish"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-admin"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If I change the client app as well then I should see both apps in publish array.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-client"</span><span class="p">,</span><span class="w"> </span><span class="s2">"branding-logger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-client"</span><span class="p">,</span><span class="w"> </span><span class="s2">"branding-logger"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-client"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"publish"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cutepuppies-client"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cutepuppies-admin"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I will add below method for getting publish apps</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">affectedApps</span><span class="p">(</span><span class="nx">command</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">execSync</span><span class="p">(</span><span class="s2">`npx nx affected:apps --base=</span><span class="p">${</span><span class="nx">baseSha</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">trim</span><span class="p">();</span>

  <span class="kd">let</span> <span class="nx">apps</span> <span class="o">=</span> <span class="nx">x</span> <span class="p">?</span> <span class="nx">x</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n\n</span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> - </span><span class="dl">'</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
  <span class="nx">apps</span> <span class="o">=</span> <span class="nx">apps</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">).</span><span class="nx">trim</span><span class="p">());</span>

  <span class="k">return</span> <span class="p">{</span> <span class="p">[</span><span class="nx">command</span><span class="p">]:</span> <span class="nx">apps</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The new script for <code class="language-plaintext highlighter-rouge">generate-ci-command.js</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">execSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">execSync</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">isMaster</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">False</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">baseSha</span> <span class="o">=</span> <span class="nx">isMaster</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">origin/main~1</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">origin/main</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">lint</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">commands</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">...</span><span class="nx">affectedApps</span><span class="p">(</span><span class="dl">'</span><span class="s1">publish</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// publish command for the apps</span>
  <span class="p">})</span>
<span class="p">);</span>

<span class="kd">function</span> <span class="nx">commands</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
    <span class="nx">execSync</span><span class="p">(</span><span class="s2">`npx nx print-affected --base=</span><span class="p">${</span><span class="nx">baseSha</span><span class="p">}</span><span class="s2"> --target=</span><span class="p">${</span><span class="nx">target</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
  <span class="p">).</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">project</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span> <span class="p">[</span><span class="nx">target</span><span class="p">]:</span> <span class="nx">array</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">affectedApps</span><span class="p">(</span><span class="nx">command</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">execSync</span><span class="p">(</span><span class="s2">`npx nx affected:apps --base=</span><span class="p">${</span><span class="nx">baseSha</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">trim</span><span class="p">();</span>

  <span class="kd">let</span> <span class="nx">apps</span> <span class="o">=</span> <span class="nx">x</span> <span class="p">?</span> <span class="nx">x</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n\n</span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> - </span><span class="dl">'</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="p">[];</span>
  <span class="nx">apps</span> <span class="o">=</span> <span class="nx">apps</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">).</span><span class="nx">trim</span><span class="p">());</span>

  <span class="k">return</span> <span class="p">{</span> <span class="p">[</span><span class="nx">command</span><span class="p">]:</span> <span class="nx">apps</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="step--lets-add-packagejson-in-applications">Step : Lets Add Package.json in applications</h3>

<p>Admin app package.json
<img src="https://i.imgur.com/FBImW9k.png" alt="" class="full"></p>

<p>Client app package.json</p>

<p><img src="https://i.imgur.com/dsaUa6N.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/FtHLQEb.png" alt="" class="full"></p>

<h3 id="step--update-workspacejson-for-app">Step : Update workspace.json for app</h3>

<p>In order to copy package.json file after build in the dist folder update the workspace file.</p>

<p>admin project
<img src="https://i.imgur.com/Wksie6X.png" alt="" class="full"></p>

<p>client project</p>

<p><img src="https://i.imgur.com/FiXMBLL.png" alt="" class="full"></p>

<h3 id="step--build-in-production-mode">Step : Build in Production Mode</h3>

<p>I want to build my angular app with below</p>

<ol>
  <li>production mode</li>
  <li>no output file hashing</li>
  <li>I want source map file so that I can debug my source file.</li>
</ol>

<p>Below is the nx build command to fulfill above requirements</p>

<pre><code class="language-shell=">nx run-many --target=build --projects=cutepuppies-client,cutepuppies-admin --parallel --configuration=production --outputHashing=none --sourceMap=true
</code></pre>

<p>Run above nx build command</p>

<p><img src="https://i.imgur.com/qFdZhxH.png" alt="" class="full"></p>

<p>Notice in the dist folder in admin folder we got map file and package.json
<img src="https://i.imgur.com/xZq2B3J.png" alt="" class="full">
client project
<img src="https://i.imgur.com/0v10ELf.png" alt="" class="full"></p>

<h3 id="step-publishing-test-results-in-azure-pipeline-build">Step: Publishing Test Results in Azure Pipeline Build</h3>

<p>https://hackmd.io/ChTI9iFXQXGdlQAWrcqrKA</p>

<h3 id="step-publishing-code-coverage-in-azure-pipeline-build">Step: Publishing Code Coverage in Azure Pipeline Build</h3>

<p>https://hackmd.io/Aiksk5NqQouDgKcZLjnHfQ</p>

<h3 id="step-add-npmrc-file-to-app-that-we-want-to-publish-npm">Step: Add .npmrc file to app that we want to publish npm</h3>

<p>Get access token from (npm.js)[https://www.npmjs.com/]</p>

<p><img src="https://i.imgur.com/XIRXjjC.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/ZXEZZYf.png" alt="" class="full"></p>

<p>Generating new access token in npmjs</p>

<p><img src="https://i.imgur.com/VlwX0n3.png" alt="" class="full"></p>

<p>Adding npmrc file with authtoken
<img src="https://i.imgur.com/cHRfq8B.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/aKO5rIy.png" alt="" class="full"></p>

<h3 id="step-updating-packagejson-version--publish-npm-package">Step: Updating Package.json Version &amp; Publish Npm package</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * . bump the version
 * . add npmrc file (if required)
 * . publish to npm package repository
 *
 * Example: node ./publish-npm.js $(COMMANDS) $(Build.BuildNumber)
 *
 */</span>

<span class="kd">const</span> <span class="nx">execSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">execSync</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">basePackageJson</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../package.json</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">commands</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
  <span class="na">buildNumber</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Received Args: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">args</span><span class="p">.</span><span class="nx">commands</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Commands are required</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">commands</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">commands</span><span class="p">);</span>
<span class="cm">/*
let commands = {
  publish: ['cutepuppies-admin', 'cutepuppies-client'],
};
*/</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">args</span><span class="p">.</span><span class="nx">buildNumber</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Build Number is required</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">buildNumber</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">buildNumber</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="c1">// let buildNumber = '3243';</span>

<span class="kd">const</span> <span class="nx">projects</span> <span class="o">=</span> <span class="nx">commands</span><span class="p">[</span><span class="dl">'</span><span class="s1">publish</span><span class="dl">'</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">newVersion</span> <span class="o">=</span> <span class="nx">getNewVesrion</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`new npm version would be: </span><span class="p">${</span><span class="nx">newVersion</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">updatePublishingPackageJsonVersion</span><span class="p">();</span>
<span class="nx">publishNpmPackage</span><span class="p">();</span>

<span class="k">return</span> <span class="nx">newVersion</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">getNewVesrion</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">currentVersion</span> <span class="o">=</span> <span class="nx">basePackageJson</span><span class="p">.</span><span class="nx">version</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">currentVersion</span>
    <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">?</span> <span class="nx">buildNumber</span> <span class="p">:</span> <span class="nx">x</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">updatePublishingPackageJsonVersion</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">projects</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">updateVersion</span><span class="p">(</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">../../</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`dist/apps/</span><span class="p">${</span><span class="nx">project</span><span class="p">}</span><span class="s2">/package.json`</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">updateVersion</span><span class="p">(</span><span class="nx">packageJsonFilePath</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="kr">package</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">packageJsonFilePath</span><span class="p">);</span>
  <span class="kr">package</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="nx">newVersion</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">packageJsonFilePath</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kr">package</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s2">`Version updated for the app </span><span class="p">${</span><span class="kr">package</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">newVersion</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">publishNpmPackage</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">projects</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">app</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cwd</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">../../</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`dist/apps/</span><span class="p">${</span><span class="nx">app</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`publishing to npm from: `</span><span class="p">,</span> <span class="nx">cwd</span><span class="p">,</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">execSync</span><span class="p">(</span>
      <span class="s2">`npm publish --access public`</span><span class="p">,</span>
      <span class="p">{</span> <span class="nx">cwd</span><span class="p">,</span> <span class="na">stdio</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">},</span>
      <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

        <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">app</span><span class="p">}</span><span class="s2"> is published`</span><span class="p">,</span> <span class="nx">newVersion</span><span class="p">,</span> <span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="step--push-you-changes-and-trigger-build">Step : Push you changes and Trigger Build</h3>

<p>See both admin and client is published.
<img src="https://i.imgur.com/yd4fgCr.png" alt="" class="full"></p>

<h3 id="step-only-change-admin-and-notice-only-admin-is-published-in-npm">Step: Only change Admin and Notice only Admin is published in NPM</h3>

<p><img src="https://i.imgur.com/vxX7r3e.png" alt="" class="full"></p>

<p><img src="https://i.imgur.com/WKNOavp.png" alt="" class="full"></p>

<h2 id="karma-failing-when-no-test-present">Karma failing when no test present</h2>

<p>Karma test will fail if u have not tests.
Therefore, if you want to stop this behavior then you need to go to <code class="language-plaintext highlighter-rouge">karma.conf.js</code> at root location where u see <code class="language-plaintext highlighter-rouge">package.json</code> and add below flag as false.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="err">failOnEmptyTestSuite:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></code></pre></div></div>

<h2 id="monorepo-architecture-guideline-for-developers">Monorepo Architecture Guideline for developers</h2>

<h3 id="what-do-smart-components-do">What do smart components do?Â </h3>

<ul>
  <li>It can do dependency injection and have service storesÂ  injected.</li>
  <li>It can only send command</li>
  <li>It can only call query methods to store to get some result/data</li>
  <li>It can not write any filter,sort kind of logic move them in store</li>
  <li>It can not publish event</li>
  <li>It can not have business query logic or model update logic</li>
  <li>It can pass some data structure to nested dumb/presentation components</li>
</ul>

<h3 id="what-is-dumb--presentation-componetn-can-do">What is dumb / presentation componetn can do?</h3>

<ul>
  <li>No dependency injection for service and store</li>
  <li>Only input and output</li>
  <li>Responsible for rendering data</li>
  <li>No message publishing/sending</li>
  <li>No store query no model state mutation</li>
</ul>

<h3 id="what-is-a-service">What is a service?</h3>

<ol>
  <li>It has business logic and</li>
  <li>It can take advantage of API service.</li>
  <li>Most of the services are message handlers.</li>
</ol>

<p>Quiz: Where should I write the code to create a mcq widget?</p>

<h3 id="what-is-a-model">What is a Model?</h3>

<ul>
  <li>
    <p>It is a data structure which has state.</p>
  </li>
  <li>It must not have business logic.</li>
  <li>It can have getters and setters.</li>
</ul>

<h3 id="what-is-a-store">What is a Store?Â </h3>

<p>Is a collection of models.Â  If you have multiple models of the same type, create store to retrieve them and put them in the collection.</p>

<ol>
  <li>Donâ€™t write business logic to mutate the model state in store</li>
  <li>Business logic to mutate model state goes in SERVICES only.</li>
  <li>All Model related queries (filter, sort etc ) must be written in the Store that component can call upon.</li>
  <li>
    <p>Store we can write code that does not go in one model and you want span over the multiple instances of the model.</p>
  </li>
  <li>Example: Sorting models inside store, Asserting before inserting model in collection.</li>
</ol>

<h3 id="what-is-an-api-service">What is an API service?</h3>

<ol>
  <li>Makes http network calls and returns promises.</li>
  <li>It has httpClient dependency and extends Base API Service.</li>
  <li>API service mostly returns the client side Model object and Server is supposed to return the same Model Data Structure to the client. However, in case there is a mismatch between the result comes from Server vs client. Then Use DTO for server side data structure. DTO should remain under the DATA folder of the project.</li>
</ol>

<h3 id="who-depends-on-whom-within-a-library-">Who depends on whom within a library ?Â </h3>

<p>We have component layer, message handlers and api service layers.</p>

<ul>
  <li>Component can depend on Model and Message service</li>
  <li>Message Handler can depend on model and api</li>
  <li>API service can depend on httpclient and dto</li>
</ul>

<h3 id="before-push-to-git-guidelines">Before Push to Git Guidelines</h3>

<p>âœ… RUN TEST: npm run affected:test
âœ… RUN LINT: npm run affected:lint</p>

<p>You can always run affected projects on your feature branch by giving its name.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run affected:test --base=origin/features/PBI23/MessageHandlers
npm run affected:lint --base=origin/features/PBI23/MessageHandlers
</code></pre></div></div>

<h3 id="naming-conventions">Naming conventions</h3>

<p>Feel free to follow any naming conventions provided in your organization. Here is what I recommend:</p>

<p><img src="https://i.imgur.com/Z7x7ZUP.png" alt="" class="full"></p>

<h3 id="nx-related-questions">Nx Related Questions</h3>

<ul>
  <li>
    <p><strong>Does the lib projects have npm versions?</strong>
<strong>Answer:</strong> No, because they are not buildable and publishable.</p>
  </li>
  <li>
    <p><strong>How should we branch in monorepo ?</strong>
<strong>Answer:</strong> V1, V2, V3 are the branches for the monorepo.</p>
  </li>
  <li>
    <p><strong>When do we create branches ?</strong>
<strong>Answer:</strong> As you move your code to a new environment it is recommended to create a separate branch in monorepo.</p>
  </li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li>
<strong>Source Code</strong>: https://github.com/rupeshtiwari/coding-examples-angular-monorepo-with-nx</li>
  <li>
<strong>Source Code</strong>: https://github.com/rupeshtiwari/coding-examples-angular-monorepo-nx-azure-ci-cd</li>
  <li><a href="https://ss64.com/nt/">An A-Z Index of the Windows CMD command line</a></li>
  <li>https://nx.dev/latest/react/getting-started/getting-started</li>
</ul>

<hr>

<p><em>Thanks for reading my article till end. I hope you learned something special today. If you enjoyed this article then please share to your friends and if you have suggestions or thoughts to share with me then please write in the comment box.</em></p>

<div class="notice--success">
<strong>ðŸ’– Say ðŸ‘‹ to me!</strong>
<br>Rupesh Tiwari
<br>Founder of <a href="https://www.fullstackmaster.net">Fullstack Master </a>
<br>Email: <a href="mailto:rupesh.tiwari.info@gmail.com?subject=Hi">rupesh.tiwari.info@gmail.com</a>
<br>Website: <a href="https://www.rupeshtiwari.com">RupeshTiwari.com </a>
</div>
<p><img src="https://imgur.com/5fBatz9.png" alt="" class="full"></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#beginners" class="page__taxonomy-item" rel="tag">beginners</a><span class="sep">, </span>
    
      <a href="/tags/#javascript" class="page__taxonomy-item" rel="tag">javascript</a><span class="sep">, </span>
    
      <a href="/tags/#tutorial" class="page__taxonomy-item" rel="tag">tutorial</a><span class="sep">, </span>
    
      <a href="/tags/#webdev" class="page__taxonomy-item" rel="tag">webdev</a>
    
    </span>
  </p>




        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-11-19T00:00:00+00:00">November 19, 2021</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=rupeshtiwari_co&amp;text=Getting+Started+with+Monorepo+with+Nx+Nrwl%20https%3A%2F%2Fwww.rupeshtiwari.com%2Fgetting-started-with-monorepo-with-nx-nrwl%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.rupeshtiwari.com%2Fgetting-started-with-monorepo-with-nx-nrwl%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.rupeshtiwari.com%2Fgetting-started-with-monorepo-with-nx-nrwl%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/cloud-solution-architect-technical-interview-questions/" class="pagination--pager" title="Cloud Solution Architect Technical Interview Questions
">Previous</a>
    
    
      <a href="/symmetric-and-asymmetric-encryption-basics/" class="pagination--pager" title="Symmetric and Asymmetric Encryption Basics
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://i.imgur.com/8axKkdp.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-to-improve-reliability-in-the-cloud/" rel="permalink">How to improve Reliability in the cloud?
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Did you get a phone call from your customer saying they want to improve their application reliability while you move their workload to the cloud? If yes t...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://i.imgur.com/7tGRoEv.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/cost-optimization-with-aws-spot-ec2-instances/" rel="permalink">Cost Optimization with Amazon EC2 Spot Instances
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  Creating cost optimized highly scalable cloud architecture is challenging but it is possible! Using Spot Amazon Elastic Compute Cloud (Amazon EC2) instanc...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://i.imgur.com/WQWdzrb.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/cloud-security-defense-in-depth-azure-approach/" rel="permalink">Cloud Security Defense In-Depth Azure Approach
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  In a traditional data center you create one perimeter, secure them by installing firewall, WAF, SIEMS etc. and have 100% confidence that the data center i...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://i.imgur.com/aPeeiUM.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-to-maintain-well-architected-framework-on-cloud/" rel="permalink">How to Maintain Well-Architected-Framework on Cloud
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">How to make sure our workload in the cloud is secure, reliable. How to monitor the cost of your cloud resources consumption? Is there any automation you can ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <script data-ad-client="ca-pub-1700383344966810" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Disable Inspection Function -->
<script type="text/javascript">
  
</script>
<script>
    document.onkeydown = function (e) {
        if (event.keyCode == 123) {
            return false;
        }
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
            return false;
        }
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
            return false;
        }
        if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
            return false;
        }
    }
</script>
<div id="tawk_5eff6dee223d045fcb7b449a"></div>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
    var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
    (function () {
        var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
        s1.async = true;
        s1.src = 'https://embed.tawk.to/5eff6dee223d045fcb7b449a/default';
        s1.charset = 'UTF-8';
        s1.setAttribute('crossorigin', '*');
        s0.parentNode.insertBefore(s1, s0);
    })();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.9.2/mermaid.min.js"></script>
<script>
    mermaid.initialize({ startOnLoad: true });
</script>
<link rel="stylesheet" href="/assets/css/blog.css">
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://www.rupeshtiwari.com/posts" rel="nofollow noopener noreferrer"><i class="fas fa-registered" aria-hidden="true"></i> Blogs for Developers</a></li>
        
      
        
          <li><a href="https://www.facebook.com/fullstackmaster1" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/rupesh-tiwari" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://fullstackmaster.net/course/3/mastering-meanjs" rel="nofollow noopener noreferrer"><i class="fab fa-angular" aria-hidden="true"></i> Learn Angular</a></li>
        
      
        
          <li><a href="https://github.com/rupeshtiwari#javascript-for-beginners-client-side" rel="nofollow noopener noreferrer"><i class="fas fa-crown" aria-hidden="true"></i> Become Software Developer Free</a></li>
        
      
        
          <li><a href="http://github.com/rupeshtiwari" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://rupesh-tiwari.medium.com/" rel="nofollow noopener noreferrer"><i class="fab fa-medium" aria-hidden="true"></i> Medium</a></li>
        
      
        
          <li><a href="https://dev.to/rupeshtiwari" rel="nofollow noopener noreferrer"><i class="fab fa-dev" aria-hidden="true"></i> Dev.to</a></li>
        
      
        
          <li><a href="https://www.fullstackmaster.net" rel="nofollow noopener noreferrer"><i class="fas fa-graduation-cap" aria-hidden="true"></i> Fullstack Master</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">Â© 2022 Rupesh Tiwari - Founder of Fullstack Master. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://www.rupeshtiwari.com/getting-started-with-monorepo-with-nx-nrwl/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/getting-started-with-monorepo-with-nx-nrwl"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://https-rupeshtiwari-github-io-1.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </body>
</html>
